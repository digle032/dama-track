<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title><%= shipment ? 'Edit Shipment' : 'Add Shipment' %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f6f7fb; }
    .card { border: 0; border-radius: 1rem; box-shadow: 0 6px 18px rgba(0,0,0,.06); }
  </style>
</head>
<body>

  <div class="container mt-5" style="max-width: 860px;">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="mb-0"><%= shipment ? 'Edit Shipment' : 'Add Shipment' %></h3>
      <a class="btn btn-outline-secondary" href="/shipments">
        ‚Üê Back
      </a>
    </div>

    <div class="card">
      <div class="card-body">
        <% if (typeof error === 'string' && error) { %>
          <div class="alert alert-danger"><%= error %></div>
        <% } %>

        <form method="POST" action="<%= action %>">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Date &amp; Time</label>
              <input
                type="datetime-local"
                name="date"
                id="dateInput"
                class="form-control"
                value="<%= shipment?.date ? new Date(shipment.date).toISOString().slice(0,16) : '' %>"
                required
              >
            </div>

            <div class="col-md-6">
              <label class="form-label">Client</label>
              <input type="text" name="client" class="form-control" value="<%= shipment?.client || '' %>" required>
            </div>

            <div class="col-12">
              <label class="form-label">Description</label>
              <textarea name="location" class="form-control" rows="3" required><%= shipment?.location || '' %></textarea>
            </div>

            <div class="col-md-6">
              <label class="form-label">Tracking Number</label>
              <input
                type="text"
                name="tracking"
                id="tracking"
                class="form-control"
                value="<%= shipment?.tracking || '' %>"
                required
                autofocus
              >
            </div>

            <div class="col-md-3">
              <label class="form-label">Transport</label>
              <select name="transport" class="form-control">
                <option value="">-- Select Transport --</option>
                <option value="FedEx"   <%= shipment?.transport === 'FedEx' ? 'selected' : '' %>>FedEx</option>
                <option value="UPS"     <%= shipment?.transport === 'UPS' ? 'selected' : '' %>>UPS</option>
                <option value="Amazon"  <%= shipment?.transport === 'Amazon' ? 'selected' : '' %>>Amazon</option>
                <option value="USPS"    <%= shipment?.transport === 'USPS' ? 'selected' : '' %>>USPS</option>
                <option value="Other"   <%= shipment?.transport === 'Other' ? 'selected' : '' %>>Other</option>
              </select>
            </div>

            <div class="col-md-3">
              <label class="form-label">Courier</label>
              <select name="courier" class="form-control">
                <option value="">-- Select Courier --</option>
                <option value="Zipcode"       <%= shipment?.courier === 'Zipcode' ? 'selected' : '' %>>Zipcode</option>
                <option value="Release"       <%= shipment?.courier === 'Release' ? 'selected' : '' %>>Release</option>
                <option value="Translogic"    <%= shipment?.courier === 'Translogic' ? 'selected' : '' %>>Translogic</option>
                <option value="Mc Logistics"  <%= shipment?.courier === 'Mc Logistics' ? 'selected' : '' %>>Mc Logistics</option>
                <option value="Unknown"       <%= shipment?.courier === 'Unknown' ? 'selected' : '' %>>Unknown</option>
              </select>
            </div>

            <div class="col-md-3">
              <label class="form-label">Status</label>
              <select name="status" class="form-control">
                <option value="">-- Select Status --</option>
                <option value="Processed" <%= shipment?.status === 'Processed' ? 'selected' : '' %>>Processed</option>
                <option value="Unknown"   <%= shipment?.status === 'Unknown' ? 'selected' : '' %>>Unknown</option>
              </select>
            </div>

            <div class="col-12 d-grid">
              <button type="submit" class="btn btn-success btn-lg">
                <%= shipment ? 'Update Shipment' : 'Add Shipment' %>
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Stabilize submit; normalize tracking; default datetime if empty -->
  <script>
    // Default now for new entries if no value present
    (function() {
      const input = document.getElementById('dateInput');
      if (input && !input.value) {
        const d = new Date();
        d.setMinutes(d.getMinutes() - d.getTimezoneOffset());
        input.value = d.toISOString().slice(0,16);
      }
    })();

    (function() {
      const form = document.querySelector('form');
      const trackingInput = document.getElementById('tracking');
      const btn = form.querySelector('button[type="submit"]');
      if (trackingInput) trackingInput.focus();

      form.addEventListener('submit', function() {
        if (form.dataset.submitting === 'true') return false;
        form.dataset.submitting = 'true';
        if (btn) btn.disabled = true;
        if (trackingInput && trackingInput.value) {
          trackingInput.value = trackingInput.value.replace(/\s+/g, '').trim();
        }
      });
    })();
  </script>
</body>
</html>

